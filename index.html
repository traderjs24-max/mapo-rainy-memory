<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapo, Rainy Memory</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* [ê¸°ë³¸ ì„¤ì •] */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; }
        body, html { width: 100%; height: 100%; overflow: hidden; background-color: transparent; }

        /* ë°°ê²½ ì„¤ì • */
        .video-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1; opacity: 0.7;
            background-image: url('https://images.pexels.com/photos/1102909/pexels-photo-1102909.jpeg?auto=compress&cs=tinysrgb&w=1600');
            background-size: cover; background-position: center;
        }

        .black-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; z-index: -2; }

        .container {
            position: relative; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.4); color: #fff; text-align: center; z-index: 10;
        }

        /* íƒ€ì´í‹€ */
        .title {
            font-size: 4.5rem; font-weight: 700; margin-bottom: 5px;
            letter-spacing: -2px; text-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-height: 1.2em; 
        }
        .cursor {
            display: inline-block; width: 3px; height: 1em; background-color: #fff;
            margin-left: 5px; animation: blink 1s infinite; vertical-align: middle;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .subtitle {
            font-size: 1.1rem; font-weight: 300; letter-spacing: 2px; opacity: 0.9;
            margin-bottom: 20px; animation: fadeIn 3s ease-in-out 1s backwards;
        }

        /* ì‹œê³„ */
        #real-time-clock {
            font-size: 0.9rem; font-weight: 300; letter-spacing: 1px;
            opacity: 0.7; border: 1px solid rgba(255,255,255,0.3);
            padding: 5px 15px; border-radius: 20px;
            animation: fadeIn 3s ease-in-out 2s backwards;
        }

        .start-btn {
            margin-top: 50px; padding: 15px 45px;
            border: 1px solid rgba(255,255,255,0.6); background: transparent;
            color: #fff; font-weight: 500; cursor: pointer; transition: 0.3s;
            backdrop-filter: blur(5px); animation: fadeIn 3s ease-in-out 2.5s backwards;
        }
        .start-btn:hover { background: #fff; color: #000; border-color: #fff; transform: translateY(-3px); }

        /* ë²„íŠ¼ ê·¸ë£¹ */
        .button-group { margin-top: 40px; display: none; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .menu-btn {
            padding: 12px 25px; border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3); color: #eee; font-weight: 400;
            cursor: pointer; transition: 0.3s;
        }
        .menu-btn:hover { background: #fff; color: #000; border-color: #fff; }

        .sound-controls {
            position: absolute; bottom: 40px; right: 40px;
            background: rgba(0, 0, 0, 0.6); padding: 20px;
            border-radius: 8px; backdrop-filter: blur(10px);
            display: none; text-align: left; z-index: 20;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .control-group { margin-bottom: 15px; }
        .label { font-size: 0.8rem; margin-bottom: 8px; display: block; opacity: 0.7; font-weight: 300; }
        input[type=range] { width: 120px; cursor: pointer; accent-color: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
        /* ëª¨ë‹¬ ê³µí†µ */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); z-index: 100; backdrop-filter: blur(10px);
            justify-content: center; align-items: center; animation: fadeIn 0.4s; color: #fff;
        }
        .close-btn {
            position: absolute; top: 30px; right: 40px; font-size: 2.5rem;
            cursor: pointer; background: none; border: none; color: #fff;
            transition: 0.3s; z-index: 101; font-weight: 100;
        }
        .close-btn:hover { transform: rotate(90deg); color: #ccc; }

        /* ë®¤ì§ë£¸ */
        .music-room { width: 90%; max-width: 900px; height: 80vh; display: flex; gap: 50px; }
        .music-list { flex: 1; border-right: 1px solid rgba(255,255,255,0.1); padding-right: 30px; overflow-y: auto; }
        .track-item {
            padding: 20px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; transition: 0.3s; display: flex; justify-content: space-between; align-items: center;
            color: rgba(255, 255, 255, 0.6); 
        }
        .track-item:hover { background: rgba(255,255,255,0.05); padding-left: 20px; color: #fff; }
        .track-item.active { color: #fff; font-weight: 700; border-left: 3px solid #fff; padding-left: 20px; background: rgba(255,255,255,0.02); }
        .track-title { font-size: 1.1rem; margin-bottom: 5px; }
        .track-artist { font-size: 0.8rem; opacity: 0.5; font-weight: 300; }
        .music-info { flex: 1.2; padding: 20px; display: flex; flex-direction: column; justify-content: center; }
        .info-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; letter-spacing: -1px; }
        .info-artist { font-size: 1rem; opacity: 0.6; margin-bottom: 40px; font-weight: 300; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 20px; display: inline-block;}
        .info-desc { font-size: 1rem; line-height: 1.8; opacity: 0.8; white-space: pre-line; font-weight: 300; }

        /* [ì¼ê¸°ì¥/ë°©ëª…ë¡/ì†Œì„¤ ê³µí†µ ìŠ¤íƒ€ì¼] */
        .diary-paper, .guestbook-paper, .novel-paper {
            background: #1a1a1a; border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 50px; width: 90%; max-width: 600px; height: 80vh;
            overflow-y: auto; color: #eee; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
        }
        .novel-paper { max-width: 800px; }

        .diary-form {
            margin-bottom: 40px; padding-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-label { display: block; font-size: 0.8rem; opacity: 0.6; margin-bottom: 5px; }
        
        .custom-input, .custom-textarea {
            width: 100%; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); color: #fff;
            padding: 10px; font-size: 1rem; outline: none; transition: 0.3s;
        }
        .custom-input:focus, .custom-textarea:focus { border-color: #fff; background: rgba(255,255,255,0.1); }
        .custom-textarea { height: 100px; resize: none; }
        
        .novel-textarea { height: 300px; line-height: 1.8; font-size: 1.05rem; }

        .write-btn {
            width: 100%; padding: 12px; background: #fff; color: #000;
            border: none; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .write-btn:hover { background: #ddd; }
        .write-btn.edit-mode { background: #ffd700; } 

        .diary-entry, .guestbook-entry { 
            background: rgba(255,255,255,0.03); 
            padding: 25px; margin-bottom: 20px; 
            text-align: left; position: relative;
        }
        .diary-title { 
            font-weight: 700; font-size: 1.4rem; margin-bottom: 10px; color: #fff;
            padding-right: 140px; word-break: keep-all; 
        }
        .diary-date { font-size: 0.8rem; opacity: 0.5; margin-bottom: 15px; display: block; }
        .diary-content { font-size: 0.95rem; opacity: 0.8; line-height: 1.8; white-space: pre-line; }
        
        .entry-actions {
            position: absolute; top: 20px; right: 20px;
            display: flex; gap: 8px;
        }
        .action-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.5); font-size: 0.7rem; padding: 5px 10px;
            cursor: pointer; transition: 0.3s;
        }
        .action-btn:hover { border-color: #fff; color: #fff; }
        .delete-btn:hover { border-color: red; color: red; }

        /* ë°©ëª…ë¡ ìŠ¤íƒ€ì¼ */
        .guestbook-entry { border-left: 2px solid #aaa; padding: 20px; }
        .gb-header { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: flex-end; }
        .gb-name { font-weight: 700; font-size: 1.1rem; color: #fff; }
        .gb-date { font-size: 0.75rem; opacity: 0.5; }
        .gb-message { font-size: 0.95rem; opacity: 0.9; white-space: pre-line; line-height: 1.6; }

        .map-window {
            width: 80%; height: 80%; max-width: 1000px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        .dark-map { width: 100%; height: 100%; border: 0; filter: invert(100%) hue-rotate(180deg) contrast(1.2) grayscale(0.2); }

        @media (max-width: 768px) {
            .music-room { flex-direction: column; overflow-y: auto; }
            .music-list { height: 250px; border-right: none; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; margin-bottom: 20px; }
            .title { font-size: 3rem; }
            .diary-paper, .guestbook-paper, .novel-paper { padding: 30px; }
        }
    </style>
</head>
<body>

    <div class="black-backdrop"></div>
    <video class="video-bg" autoplay muted loop playsinline><source src="london_rain.mp4" type="video/mp4"></video>
    
    <audio id="bg-music"><source src="chopin_raindrop.mp3" type="audio/mp3"></audio> 
    <audio id="rain" loop><source src="rain_sound.mp3" type="audio/mp3"></audio>

    <div class="container">
        <h1 class="title"><span id="typing-text"></span><span class="cursor"></span></h1>
        <p class="subtitle">í•˜ëŠ˜ê³µì›ì˜ ì–µìƒˆ, ê·¸ë¦¬ê³  ì‡¼íŒ½</p>
        <div id="real-time-clock">00:00:00</div>
        
        <button class="start-btn" onclick="startExperience()">ì‚°ì±… ì‹œì‘í•˜ê¸°</button>
        
        <div class="button-group">
            <button class="menu-btn" onclick="openModal('musicModal')">ğŸ§ Music Room</button>
            <button class="menu-btn" onclick="openModal('diaryModal')">ğŸ“– Diary</button>
            <button class="menu-btn" onclick="openModal('novelModal')">âœï¸ Novel Studio</button>
            <button class="menu-btn" onclick="openModal('guestbookModal')">ğŸ–Šï¸ Guestbook</button>
            <button class="menu-btn" onclick="openModal('mapModal')">ğŸ—ºï¸ Map</button>
        </div>
    </div>

    <div class="sound-controls" id="mixer">
        <div class="control-group"><span class="label">Music Volume</span><input type="range" min="0" max="1" step="0.01" value="0.5" oninput="setVolume('bg-music', this.value)"></div>
        <div class="control-group"><span class="label">Rain Volume</span><input type="range" min="0" max="1" step="0.01" value="0.5" oninput="setVolume('rain', this.value)"></div>
    </div>

    <div class="modal-overlay" id="musicModal">
        <button class="close-btn" onclick="closeModal('musicModal')">Ã—</button>
        <div class="music-room">
            <div class="music-list" id="playlist-container"></div>
            <div class="music-info">
                <h2 class="info-title" id="track-title">Select Music</h2>
                <p class="info-artist" id="track-artist">Mapo Sentiment Collection</p>
                <p class="info-desc" id="track-desc">ë¹„ ì˜¤ëŠ” í•˜ëŠ˜ê³µì›ê³¼ ì–´ìš¸ë¦¬ëŠ” ê³¡ì„ ì„ íƒí•´ì£¼ì„¸ìš”.<br>ìŒì•…ì€ í’ê²½ì„ ì™„ì„±í•˜ëŠ” ë§ˆì§€ë§‰ ì¡°ê°ì…ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="diaryModal">
        <div class="diary-paper">
            <button class="close-btn" onclick="closeModal('diaryModal')">Ã—</button>
            <div class="diary-form">
                <div class="input-group"><label class="input-label">Title</label><input type="text" id="input-title" class="custom-input" placeholder="ì˜¤ëŠ˜ì˜ ì œëª©"></div>
                <div class="input-group"><label class="input-label">Content</label><textarea id="input-content" class="custom-textarea" placeholder="ìƒê°ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea></div>
                <button class="write-btn" id="save-btn" onclick="handleSave()">ê¸°ë¡í•˜ê¸°</button>
            </div>
            <div id="diary-container"></div>
        </div>
    </div>

    <div class="modal-overlay" id="novelModal">
        <div class="novel-paper">
            <button class="close-btn" onclick="closeModal('novelModal')">Ã—</button>
            <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; letter-spacing: -1px; color: #fff;">Novel Studio</h2>
            <div class="diary-form">
                <div class="input-group"><label class="input-label">Chapter Title</label><input type="text" id="novel-title" class="custom-input" placeholder="ì±•í„° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="input-group"><label class="input-label">Story Content</label><textarea id="novel-content" class="custom-textarea novel-textarea" placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•˜ì„¸ìš”..."></textarea></div>
                <button class="write-btn" id="novel-save-btn" onclick="handleNovelSave()">ì €ì¥í•˜ê¸°</button>
            </div>
            <div id="novel-container"></div>
        </div>
    </div>

    <div class="modal-overlay" id="guestbookModal">
        <div class="guestbook-paper">
            <button class="close-btn" onclick="closeModal('guestbookModal')">Ã—</button>
            <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; letter-spacing: -1px;">Visitors Book</h2>
            <div class="diary-form">
                <div class="input-group"><label class="input-label">Nickname</label><input type="text" id="gb-name" class="custom-input" placeholder="ë°©ë¬¸ì ì´ë¦„"></div>
                <div class="input-group"><label class="input-label">Message</label><textarea id="gb-message" class="custom-textarea" style="height: 60px;" placeholder="ì§§ì€ ê°ìƒì„ ë‚¨ê²¨ì£¼ì„¸ìš”..."></textarea></div>
                <button class="write-btn" onclick="addGuestbook()">ë‚¨ê¸°ê¸°</button>
            </div>
            <div id="guestbook-container"></div>
        </div>
    </div>

    <div class="modal-overlay" id="mapModal">
        <div class="map-window">
            <button class="close-btn" onclick="closeModal('mapModal')">Ã—</button>
            <iframe class="dark-map" src="https://maps.google.com/maps?q=ì„œìš¸+ë§ˆí¬êµ¬+í•˜ëŠ˜ê³µì›&t=m&z=15&output=embed&iwloc=near" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </div>

    <script>
        /* === [ê¸°ëŠ¥ ë° ë°ì´í„°] === */
        const textToType = "Mapo, Rainy Memory";
        const typingElement = document.getElementById('typing-text');
        let typeIndex = 0;

        function typeWriter() {
            if (typeIndex < textToType.length) {
                typingElement.innerHTML += textToType.charAt(typeIndex);
                typeIndex++;
                setTimeout(typeWriter, 150);
            }
        }
        
        window.onload = function() {
            typeWriter();
            updateClock();
            setInterval(updateClock, 1000);
        };

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour12: false });
            document.getElementById('real-time-clock').innerText = "SEOUL " + timeString;
        }

        const musicLibrary = [
            { title: "Raindrop Prelude", artist: "FrÃ©dÃ©ric Chopin", file: "chopin_raindrop.mp3", desc: "ì‡¼íŒ½ì´ ë¹—ì†Œë¦¬ë¥¼ ë“¤ìœ¼ë©° ì‘ê³¡í•œ ëª…ê³¡ì…ë‹ˆë‹¤.<br>í•˜ëŠ˜ê³µì›ì˜ ì–µìƒˆ ì ìœ„ë¡œ ë–¨ì–´ì§€ëŠ” ë¹—ë°©ìš¸ì„ ìƒìƒí•˜ë©° ë“¤ì–´ë³´ì„¸ìš”." },
            { title: "The Four Seasons: Spring", artist: "Antonio Vivaldi", file: "spring.mp3", desc: "ê¸´ ê²¨ìš¸ì´ ê°€ê³  ìƒëª…ì´ ì›€íŠ¸ëŠ” ë´„ì„ ë…¸ë˜í•©ë‹ˆë‹¤.<br>ì°¨ê°€ìš´ ë¹—ì¤„ê¸° ì†ì—ì„œë„ ê³§ ë”°ìŠ¤í•œ í–‡ì‚´ì´ ë¹„ì¹  í¬ë§ì„ ì „í•´ì¤ë‹ˆë‹¤." },
            { title: "The Four Seasons: Summer", artist: "Antonio Vivaldi (Op. 8, RV 315)", file: "summer.mp3", desc: "ì‚¬ê³„ ì¤‘ ê°€ì¥ ê²©ë ¬í•˜ê³  ëœ¨ê±°ìš´ ê³¡ì…ë‹ˆë‹¤.<br>í•œì—¬ë¦„ ì¥ë§ˆì² , ì„¸ì°¨ê²Œ ìŸì•„ì§€ëŠ” ë¹—ì¤„ê¸°ì™€ ì²œë‘¥ì†Œë¦¬ë¥¼ ëŠê»´ë³´ì„¸ìš”." },
            { title: "The Four Seasons: Autumn", artist: "Antonio Vivaldi", file: "autumn.mp3", desc: "í’ìš”ë¡œìš´ ìˆ˜í™•ì˜ ê³„ì ˆì„ ë¬˜ì‚¬í•œ ê³¡ì…ë‹ˆë‹¤.<br>í•˜ëŠ˜ê³µì›ì˜ ì€ë¹› ì–µìƒˆê°€ ë°”ëŒì— ì¶¤ì¶”ëŠ” í’ê²½ì´ ë– ì˜¤ë¦…ë‹ˆë‹¤." },
            { title: "Winter: II. Largo", artist: "Antonio Vivaldi (RV 297)", file: "winter_largo.mp3", desc: "ë”°ëœ»í•œ ë‚œë¡œê°€ì—ì„œ ë°–ì„ ë°”ë¼ë³´ëŠ” ë“¯í•œ í‰ì˜¨í•¨.<br>ë¹—ë°©ìš¸ ê°™ì€ í”¼ì¹˜ì¹´í†  ë°˜ì£¼ ìœ„ë¡œ íë¥´ëŠ” ë°”ì´ì˜¬ë¦°ì˜ ì„œì •ì ì¸ ì„ ìœ¨ì…ë‹ˆë‹¤." },
            { title: "Nocturne Op. 9 No. 1", artist: "FrÃ©dÃ©ric Chopin", file: "nocturne_op9_1.mp3", desc: "ë°¤ì˜ ì ë§‰ê³¼ ë¹„ ì˜¤ëŠ” ë‚ ì˜ ì“¸ì“¸í•¨ì„ ë‹´ì€ ê³¡ì…ë‹ˆë‹¤.<br>ì‡¼íŒ½ íŠ¹ìœ ì˜ ì„œì •ì ì¸ ë©œë¡œë””ê°€ ë¹—ì†Œë¦¬ì™€ í•¨ê»˜ ê°ì„±ì„ ìê·¹í•©ë‹ˆë‹¤." },
            { title: "Nocturne in C# minor", artist: "FrÃ©dÃ©ric Chopin (Posth.)", file: "nocturne_c_sharp.mp3", desc: "ì˜í™” 'í”¼ì•„ë‹ˆìŠ¤íŠ¸'ì˜ ì£¼ì œê³¡ìœ¼ë¡œ ìœ ëª…í•œ ëª…ê³¡.<br>ì• ì ˆí•˜ê³  ë¹„ê·¹ì ì¸ ì•„ë¦„ë‹¤ì›€ì´ ë¹„ ì˜¤ëŠ” í’ê²½ì„ ì˜í™”ì²˜ëŸ¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤." },
            { title: "Fantaisie-Impromptu Op. 66", artist: "FrÃ©dÃ©ric Chopin", file: "fantaisie_impromptu.mp3", desc: "ìŸì•„ì§€ëŠ” ë¹—ì¤„ê¸°ì²˜ëŸ¼ ë¹ ë¥¸ ì˜¤ë¥¸ì†ì˜ ì›€ì§ì„ê³¼,<br>ê¿ˆê¾¸ëŠ” ë“¯í•œ ì¤‘ê°„ë¶€ì˜ ë©œë¡œë””ê°€ ëŒ€ì¡°ë¥¼ ì´ë£¨ëŠ” í™˜ìƒì ì¸ ê³¡ì…ë‹ˆë‹¤." }
        ];

        const bgMusic = document.getElementById('bg-music');
        const rainSound = document.getElementById('rain');
        
        let editingIndex = -1;
        let novelEditingIndex = -1;
        let currentTrackIndex = 0; 

        // [ì¤‘ìš”] ì‹œì‘ í•¨ìˆ˜ ìˆ˜ì •ë¨
        function startExperience() {
            // 1. í™”ë©´ ì „í™˜ì„ ìµœìš°ì„ ìœ¼ë¡œ ì‹¤í–‰ (ìŒì•… ì˜¤ë¥˜ê°€ ë‚˜ë„ ëŒ€ë¬¸ì€ ì—´ë¦¼)
            document.querySelector('.start-btn').style.display = 'none';
            document.querySelector('.button-group').style.display = 'flex';
            document.getElementById('mixer').style.display = 'block';

            // 2. ê·¸ ë‹¤ìŒ ê¸°ëŠ¥ ë¡œë“œ
            bgMusic.volume = 0.5; rainSound.volume = 0.5;
            
            renderPlaylist(); 
            loadDiaries(); 
            loadGuestbook(); 
            loadNovels();

            // 3. ë§ˆì§€ë§‰ìœ¼ë¡œ ìŒì•… ì¬ìƒ ì‹œë„
            playTrack(0); 
            rainSound.play().catch(e => console.log("ë¹—ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨"));
        }

        bgMusic.addEventListener('ended', function() {
            currentTrackIndex = (currentTrackIndex + 1) % musicLibrary.length;
            playTrack(currentTrackIndex);
        });

        function setVolume(id, value) { document.getElementById(id).volume = value; }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        /* [ì¼ê¸°ì¥ ì €ì¥] */
        const defaultDiaries = [{ title: "ìƒì•”ë™ì˜ ì¿ë¹› ì˜¤í›„", date: "2026.01.06 | Mapo, Seoul", content: `í•˜ëŠ˜ê³µì› ì „ë§ëŒ€ì— ì˜¬ë¼ ë¹—ì†ì— ì ê¸´ ì„œìš¸ì„ ë³¸ë‹¤.\nì € ë©€ë¦¬ íë¥´ëŠ” í•œê°• ìœ„ë¡œ ì˜…ì€ ë¬¼ì•ˆê°œê°€ í”¼ì–´ì˜¤ë¥´ê³ ...` }];
        function handleSave() {
            const t = document.getElementById('input-title'); const c = document.getElementById('input-content');
            if(t.value.trim()==""||c.value.trim()==""){alert("ì…ë ¥í•´ì£¼ì„¸ìš”");return;}
            let d = JSON.parse(localStorage.getItem('myDiaries'))||defaultDiaries;
            if(editingIndex===-1) d.unshift({title:t.value, content:c.value, date:new Date().toLocaleDateString()});
            else { d[editingIndex]={title:t.value, content:c.value, date:new Date().toLocaleDateString()}; editingIndex=-1; document.getElementById('save-btn').innerText="ê¸°ë¡í•˜ê¸°"; document.getElementById('save-btn').classList.remove('edit-mode'); }
            localStorage.setItem('myDiaries', JSON.stringify(d)); renderDiaries(d); t.value=""; c.value="";
        }
        function editDiary(i){let d=JSON.parse(localStorage.getItem('myDiaries'))||defaultDiaries;document.getElementById('input-title').value=d[i].title;document.getElementById('input-content').value=d[i].content;editingIndex=i;let b=document.getElementById('save-btn');b.innerText="ìˆ˜ì • ì™„ë£Œ";b.classList.add('edit-mode');}
        function deleteDiary(i){if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){let d=JSON.parse(localStorage.getItem('myDiaries'))||defaultDiaries;d.splice(i,1);localStorage.setItem('myDiaries',JSON.stringify(d));renderDiaries(d);}}
        function loadDiaries(){let d=JSON.parse(localStorage.getItem('myDiaries'))||defaultDiaries;renderDiaries(d);}
        function renderDiaries(d){const c=document.getElementById('diary-container');c.innerHTML='';d.forEach((e,i)=>{c.innerHTML+=`<div class="diary-entry"><div class="entry-actions"><button class="action-btn" onclick="editDiary(${i})">ìˆ˜ì •</button><button class="action-btn delete-btn" onclick="deleteDiary(${i})">ì‚­ì œ</button></div><h2 class="diary-title">${e.title}</h2><span class="diary-date">${e.date}</span><p class="diary-content">${e.content}</p></div>`;});}

        /* [ì†Œì„¤ ì €ì¥] */
        const defaultNovels = [{ title: "Chapter 1. ë¹—ì†Œë¦¬", date: "2026.01.06", content: "ê·¸ë‚ ë”°ë¼ ë¹„ëŠ” ë©ˆì¶”ì§€ ì•Šê³  ë‚´ë ¸ë‹¤.\nê·¸ëŠ” ì°½ê°€ì— ì„œì„œ..." }];
        function handleNovelSave() {
            const t = document.getElementById('novel-title'); const c = document.getElementById('novel-content');
            if(t.value.trim()==""||c.value.trim()==""){alert("ì…ë ¥í•´ì£¼ì„¸ìš”");return;}
            let n = JSON.parse(localStorage.getItem('myNovels'))||defaultNovels;
            if(novelEditingIndex===-1) n.unshift({title:t.value, content:c.value, date:new Date().toLocaleDateString()});
            else { n[novelEditingIndex]={title:t.value, content:c.value, date:new Date().toLocaleDateString()}; novelEditingIndex=-1; document.getElementById('novel-save-btn').innerText="ì €ì¥í•˜ê¸°"; document.getElementById('novel-save-btn').classList.remove('edit-mode'); }
            localStorage.setItem('myNovels', JSON.stringify(n)); renderNovels(n); t.value=""; c.value="";
        }
        function editNovel(i){let n=JSON.parse(localStorage.getItem('myNovels'))||defaultNovels;document.getElementById('novel-title').value=n[i].title;document.getElementById('novel-content').value=n[i].content;novelEditingIndex=i;let b=document.getElementById('novel-save-btn');b.innerText="ìˆ˜ì • ì™„ë£Œ";b.classList.add('edit-mode');document.querySelector('.novel-paper').scrollTop=0;}
        function deleteNovel(i){if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){let n=JSON.parse(localStorage.getItem('myNovels'))||defaultNovels;n.splice(i,1);localStorage.setItem('myNovels',JSON.stringify(n));renderNovels(n);}}
        function loadNovels(){let n=JSON.parse(localStorage.getItem('myNovels'))||defaultNovels;renderNovels(n);}
        function renderNovels(n){const c=document.getElementById('novel-container');c.innerHTML='';n.forEach((e,i)=>{c.innerHTML+=`<div class="diary-entry"><div class="entry-actions"><button class="action-btn" onclick="editNovel(${i})">ìˆ˜ì •</button><button class="action-btn delete-btn" onclick="deleteNovel(${i})">ì‚­ì œ</button></div><h2 class="diary-title">${e.title}</h2><span class="diary-date">${e.date}</span><p class="diary-content">${e.content}</p></div>`;});}

        /* [ë°©ëª…ë¡] */
        const defaultGuestbook = [{ name: "ì§€ë‚˜ê°€ë˜ ë‚˜ê·¸ë„¤", date: "2026.01.06", message: "ë¹„ ì˜¤ëŠ” ë‚ ì˜ ê°ì„±ì´ ë„ˆë¬´ ì¢‹ë„¤ìš”. ì˜ ì‰¬ë‹¤ ê°‘ë‹ˆë‹¤." }];
        function addGuestbook() {
            const n = document.getElementById('gb-name').value; const m = document.getElementById('gb-message').value;
            if(!n||!m)return alert("ì…ë ¥í•´ì£¼ì„¸ìš”");
            let g = JSON.parse(localStorage.getItem('mapoGuestbook'))||defaultGuestbook;
            g.unshift({name:n, message:m, date:new Date().toLocaleDateString()});
            localStorage.setItem('mapoGuestbook', JSON.stringify(g)); renderGuestbook(g);
            document.getElementById('gb-name').value=""; document.getElementById('gb-message').value="";
        }
        function loadGuestbook(){let g=JSON.parse(localStorage.getItem('mapoGuestbook'))||defaultGuestbook;renderGuestbook(g);}
        function renderGuestbook(g){const c=document.getElementById('guestbook-container');c.innerHTML='';g.forEach(e=>{c.innerHTML+=`<div class="guestbook-entry"><div class="gb-header"><span class="gb-name">${e.name}</span><span class="gb-date">${e.date}</span></div><p class="gb-message">${e.message}</p></div>`;});}

        /* [ìŒì•…] */
        function renderPlaylist() {
            const c = document.getElementById('playlist-container'); c.innerHTML='';
            musicLibrary.forEach((t, i) => {
                c.innerHTML += `<div class="track-item" onclick="playTrack(${i})"><div class="track-info"><div class="track-title">${t.title}</div><div class="track-artist">${t.artist}</div></div><div style="opacity:0.5;">â–¶</div></div>`;
            });
        }
        function playTrack(index) {
            currentTrackIndex = index;
            const track = musicLibrary[index];
            bgMusic.src = track.file;
            bgMusic.play(); // ì—¬ê¸°ì„œ íŒŒì¼ì´ ì—†ìœ¼ë©´ ì—ëŸ¬ê°€ ë‚˜ì§€ë§Œ, ì´ë¯¸ UIê°€ ë°”ë€ ë’¤ë¼ ê´œì°®ìŠµë‹ˆë‹¤.
            document.getElementById('track-title').innerText = track.title;
            document.getElementById('track-artist').innerText = track.artist;
            document.getElementById('track-desc').innerHTML = track.desc;
            const items = document.querySelectorAll('.track-item');
            items.forEach(item => item.classList.remove('active'));
            if(items[index]) items[index].classList.add('active');
        }
    </script>
</body>
</html>